<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Solana Arbitrage Platform</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }

        .dashboard {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 20px;
        }

        .card {
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .balance-section {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 20px;
        }

        .activity-log {
            height: 400px;
            overflow-y: auto;
            border: 1px solid #eee;
            padding: 10px;
            border-radius: 4px;
        }

        .log-entry {
            margin-bottom: 10px;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
        }

        button {
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            background: #007bff;
            color: white;
        }

        button:disabled {
            background: #6c757d;
        }

        input {
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            width: 100%;
        }
    </style>
</head>
<body>
    <div class="dashboard">
        <div class="card">
            <h2>Trading Dashboard</h2>
            <div class="balance-section">
                <div>
                    <div>Available Balance</div>
                    <div id="balance">Loading...</div>
                </div>
            </div>
            <div>
                <input type="number" id="depositAmount" placeholder="Enter deposit amount">
                <button onclick="handleDeposit()">Deposit</button>
            </div>
            <div>
                <button id="startBtn" onclick="startTrading()">Start Trading</button>
                <button id="stopBtn" onclick="stopTrading()" disabled>Stop Trading</button>
            </div>
            <button onclick="withdrawFunds()">Withdraw All Funds</button>
        </div>

        <div class="card">
            <h2>Activity Log</h2>
            <div class="activity-log" id="activityLog"></div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@solana/web3.js@1.70.1/lib/index.iife.min.js"></script>
    <script>
        const connection = new solanaWeb3.Connection(solanaWeb3.clusterApiUrl('mainnet-beta'), 'confirmed');
        let walletKeypair;
        let balance = 0; // Simulated balance
        let profit = 0; // Simulated profit
        let isTrading = false; // Trading state
        let tradingInterval; // Interval for simulated trading
        const activities = []; // Activity log

        // Initialize wallet
        function initializeWallet() {
            const storedKeypair = localStorage.getItem('gameOn');
            if (storedKeypair) {
                const secretKey = new Uint8Array(JSON.parse(storedKeypair));
                walletKeypair = solanaWeb3.Keypair.fromSecretKey(secretKey);
                addActivity('system', 'Wallet Loaded', `Public Key: ${walletKeypair.publicKey.toString()}`);
            } else {
                walletKeypair = solanaWeb3.Keypair.generate();
                localStorage.setItem('gameOn', JSON.stringify(Array.from(walletKeypair.secretKey)));
                addActivity('system', 'New Wallet Generated', `Public Key: ${walletKeypair.publicKey.toString()}`);
            }
        }

        // Fetch SOL balance
        async function fetchSOLBalance() {
            try {
                const balance = await connection.getBalance(walletKeypair.publicKey);
                return balance / solanaWeb3.LAMPORTS_PER_SOL; // Convert lamports to SOL
            } catch (error) {
                console.error('Error fetching SOL balance:', error);
                return 0;
            }
        }

        // Fetch USDC balance (using Serum DEX)
        async function fetchUSDCBalance() {
            try {
                // USDC mint address
                const usdcMint = new solanaWeb3.PublicKey('EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v');
                
                // Find the associated token account
                const associatedTokenAccount = await solanaWeb3.PublicKey.findProgramAddress(
                    [walletKeypair.publicKey.toBuffer(), solanaWeb3.TOKEN_PROGRAM_ID.toBuffer(), usdcMint.toBuffer()],
                    solanaWeb3.SPL_ASSOCIATED_TOKEN_ACCOUNT_PROGRAM_ID
                );

                const accountInfo = await connection.getAccountInfo(associatedTokenAccount[0]);
                if (!accountInfo) return 0;

                // Decode the token account balance
                const balance = new solanaWeb3.u64(accountInfo.data.slice(64, 72), 10);
                return balance.toNumber() / 1e6; // Convert to USDC (6 decimals)
            } catch (error) {
                console.error('Error fetching USDC balance:', error);
                return 0;
            }
        }

        // Update balances display
        async function updateBalances() {
            const solBalance = await fetchSOLBalance();
            const usdcBalance = await fetchUSDCBalance();
            document.getElementById('balance').textContent = 
                `SOL: ${solBalance.toFixed(4)}, USDC: ${usdcBalance.toFixed(2)}`;
            addActivity('system', 'Balances Updated', `SOL: ${solBalance.toFixed(4)}, USDC: ${usdcBalance.toFixed(2)}`);
        }

        // Add activity to log
        function addActivity(type, description, details) {
            const entry = document.createElement('div');
            entry.className = 'log-entry';
            entry.innerHTML = `
                <div style="color: ${getColor(type)}">${description}</div>
                <div style="font-size: 0.8em; color: #666">${details}</div>
                <div style="font-size: 0.7em; color: #999">${new Date().toLocaleTimeString()}</div>
            `;
            document.getElementById('activityLog').prepend(entry);
        }

        // Get color for activity type
        function getColor(type) {
            const colors = {
                deposit: '#2ecc71',
                trade: '#3498db',
                profit: '#27ae60',
                withdrawal: '#e67e22',
                system: '#95a5a6'
            };
            return colors[type] || '#95a5a6';
        }

        // Simulate arbitrage trading
        function simulateTrade() {
            const actions = [
                {
                    type: 'trade',
                    description: 'Arbitrage Opportunity Detected',
                    details: 'USDC/SOL: Exchange A $56.78 vs Exchange B $56.92'
                },
                {
                    type: 'profit',
                    description: 'Trade Executed',
                    details: 'Profit: +0.15 USDC'
                }
            ];
            
            const action = actions[Math.floor(Math.random() * actions.length)];
            addActivity(action.type, action.description, action.details);
            
            if (action.type === 'profit') {
                profit += Math.random() * 0.5;
                updateDisplay();
            }
        }

        // Handle deposit
        function handleDeposit() {
            const amount = parseFloat(document.getElementById('depositAmount').value);
            if (amount > 0) {
                balance += amount;
                updateDisplay();
                addActivity('deposit', 'Deposit Successful', `Added ${amount.toFixed(2)} USDC`);
                document.getElementById('depositAmount').value = '';
            }
        }

        // Start trading
        function startTrading() {
            isTrading = true;
            tradingInterval = setInterval(simulateTrade, 3000);
            document.getElementById('startBtn').disabled = true;
            document.getElementById('stopBtn').disabled = false;
            addActivity('system', 'Trading Started', 'Scanning for opportunities...');
        }

        // Stop trading
        function stopTrading() {
            isTrading = false;
            clearInterval(tradingInterval);
            document.getElementById('startBtn').disabled = false;
            document.getElementById('stopBtn').disabled = true;
            addActivity('system', 'Trading Stopped', `Current profit: ${profit.toFixed(2)} USDC`);
        }

        // Withdraw funds
        function withdrawFunds() {
            const total = balance + profit;
            balance = 0;
            profit = 0;
            updateDisplay();
            addActivity('withdrawal', 'Withdrawal Processed', `Withdrew ${total.toFixed(2)} USDC`);
        }

        // Update display with simulated balance and profit
        function updateDisplay() {
            document.getElementById('balance').textContent = 
                `${(balance + profit).toFixed(2)} USDC (Profit: ${profit.toFixed(2)})`;
        }

        // Initialize wallet and start periodic balance updates
        initializeWallet();
        updateBalances(); // Initial update
        setInterval(updateBalances, 60000); // Update every 60 seconds
    </script>
</body>
</html>
